import{a as se}from"./chunk-4PVDMTCU.js";import{a as ve}from"./chunk-6M6AWRGW.js";import{a as _e,b as xe}from"./chunk-DU7XOWDY.js";import{a as ue,b as ge}from"./chunk-L5BLIFW3.js";import{a as le}from"./chunk-OGQQ44XV.js";import{a as K}from"./chunk-22XSY4EJ.js";import{a as me}from"./chunk-AZJWBWL5.js";import{a as de}from"./chunk-55FSNNZ2.js";import{c as D,d as ce}from"./chunk-6M6LJACB.js";import"./chunk-UQYYX3ZV.js";import"./chunk-ZOJYGP6Z.js";import{c as pe}from"./chunk-U34JSWL2.js";import{a as Q,c as W,e as X,g as Y,j as ee,k as te,l as ie,o as oe}from"./chunk-B2HCO65P.js";import{a as re}from"./chunk-BPTFILPP.js";import{b as ae}from"./chunk-5N72VQB2.js";import"./chunk-VSPTT5AX.js";import{e as $,g as U,h as R,n as H,p as O,q,t as Z,u as J,v as ne}from"./chunk-BJBUZF5B.js";import{$a as p,Bb as B,Gb as w,Hb as P,Jb as T,Ra as s,Sa as I,V as A,_ as N,a as j,b as z,ba as G,cb as h,db as y,ea as L,eb as k,fb as V,ga as g,gb as o,ha as _,hb as i,ia as b,ib as C,ja as S,lb as f,pb as m,qb as d,ub as l,wb as x,xb as E}from"./chunk-GQGQXF3A.js";var fe=(()=>{let c=class c{transform(n,t,a){let u,v;return a==="true"?u=!0:a==="false"?u=!1:u=null,u!==null?v=n.filter(M=>M.activo==u):u===null&&(v=n),t=t.toLocaleLowerCase(),t.length!==0?v.filter(M=>M.producto.descripcion.toLocaleLowerCase().includes(t)||M.producto.codigo.toLocaleUpperCase().includes(t)):v}};c.\u0275fac=function(t){return new(t||c)},c.\u0275pipe=L({name:"filtroIngresosProductos",type:c,pure:!0,standalone:!0});let r=c;return r})();var F=J.base_url+"/ingresos-productos",Ce=(()=>{let c=class c{get getToken(){return{Authorization:localStorage.getItem("token")}}constructor(n){this.http=n}getIngresoProductos(n){return this.http.get(`${F}/${n}`,{headers:this.getToken})}listarIngresosProductos({direccion:n="desc",columna:t="id"}){return this.http.get(F,{params:{direccion:String(n),columna:t},headers:this.getToken})}nuevoIngresoProducto(n){return this.http.post(F,n,{headers:this.getToken})}actualizarIngresoProducto(n,t){return this.http.patch(`${F}/${n}`,t,{headers:this.getToken})}eliminarIngresoProducto(n){return console.log(n),this.http.delete(`${F}/${n}`,{headers:this.getToken})}};c.\u0275fac=function(t){return new(t||c)(N(R))},c.\u0275prov=A({token:c,factory:c.\u0275fac,providedIn:"root"});let r=c;return r})();function Me(r,c){if(r&1){let e=f();o(0,"button",47),m("click",function(){g(e);let t=d();return _(t.eliminarProducto())}),b(),o(1,"svg",26),C(2,"path",48),i()()}}var be=(r,c)=>c.id;function Ee(r,c){if(r&1){let e=f();o(0,"div",51),m("click",function(){let a=g(e).$implicit,u=d(2);return _(u.seleccionarProducto(a))}),o(1,"p",8),l(2),i(),o(3,"p",52),l(4),i(),o(5,"p",53),l(6),w(7,"moneda"),i()()}if(r&2){let e=c.$implicit;s(2),x(" ",e.descripcion," "),s(2),x(" ",e.unidadMedida.descripcion," "),s(2),x(" Precio: $",P(7,3,e.precioVenta)," ")}}function Pe(r,c){r&1&&(o(0,"p",54),l(1," No se encontraron productos "),i())}function Fe(r,c){if(r&1){let e=f();b(),S(),o(0,"div",29)(1,"input",49),m("ngModelChange",function(t){g(e);let a=d();return _(a.filtros.productos=t)}),i(),o(2,"div",50),k(3,Ee,8,5,"div",55,be,!1,Pe,2,0),w(6,"filtroProductos"),i()()}if(r&2){let e=d();s(),p("ngModel",e.filtros.productos),s(2),V(T(6,2,e.productos,e.filtros.productos,"true"))}}function ke(r,c){if(r&1){let e=f();o(0,"div",68)(1,"button",69),m("click",function(){g(e);let t=d(2);return _(t.deseleccionarProducto())}),b(),o(2,"svg",70),C(3,"path",71),i()(),S(),o(4,"p",72),l(5," PRODUCTO SELECCIONADO "),i()()}}function Ve(r,c){if(r&1){let e=f();o(0,"div",73)(1,"div",74)(2,"p",8),l(3," Precio de compra "),i(),o(4,"input",75),m("keyup.enter",function(){g(e);let t=d(2);return _(t.submitForm())})("keyup",function(){g(e);let t=d(2);return _(t.calcularPrecioVenta())})("ngModelChange",function(t){g(e);let a=d(2);return _(a.productoForm.precioCompra=t)}),i()(),o(5,"div",76)(6,"p",8),l(7," Porcentaje de ganancia (%) "),i(),o(8,"input",77),m("keyup.enter",function(){g(e);let t=d(2);return _(t.submitForm())})("keyup",function(){g(e);let t=d(2);return _(t.calcularPrecioVenta())})("ngModelChange",function(t){g(e);let a=d(2);return _(a.productoForm.porcentajeGanancia=t)}),i()()(),o(9,"div",35)(10,"p",8)(11,"span",9),l(12," * "),i(),l(13," Precio de venta "),i(),o(14,"input",78),m("keyup.enter",function(){g(e);let t=d(2);return _(t.submitForm())})("ngModelChange",function(t){g(e);let a=d(2);return _(a.productoForm.precioVenta=t)}),i()()}if(r&2){let e=d(2);s(4),p("disabled",e.ingreso.estado==="Completado")("ngModel",e.productoForm.precioCompra),s(4),p("disabled",e.ingreso.estado==="Completado")("ngModel",e.productoForm.porcentajeGanancia),s(6),p("disabled",e.productoForm.precioCompra>0&&e.productoForm.porcentajeGanancia>0||e.ingreso.estado==="Completado")("ngModel",e.productoForm.precioVenta)}}function Te(r,c){if(r&1){let e=f();o(0,"div",35)(1,"p",8),l(2," Precio compra "),i(),o(3,"input",75),m("keyup.enter",function(){g(e);let t=d(2);return _(t.submitForm())})("keyup",function(){g(e);let t=d(2);return _(t.calcularPrecioVenta())})("ngModelChange",function(t){g(e);let a=d(2);return _(a.productoForm.precioCompra=t)}),i()()}if(r&2){let e=d(2);s(3),p("disabled",e.ingreso.estado==="Completado")("ngModel",e.productoForm.precioCompra)}}function De(r,c){if(r&1){let e=f();o(0,"button",81),m("click",function(){g(e);let t=d(3);return _(t.agregarProducto())}),l(1," Agregar producto "),i()}}function je(r,c){if(r&1){let e=f();o(0,"button",82),m("click",function(){g(e);let t=d(3);return _(t.actualizarProducto())}),l(1," Actualizar producto "),i()}}function ze(r,c){if(r&1&&(o(0,"div",79),h(1,De,2,0,"button",80)(2,je,2,0),i()),r&2){let e=d(2);s(),y(1,e.estadoForm==="crear"?1:2)}}function Ae(r,c){if(r&1){let e=f();b(),S(),o(0,"div",29)(1,"div",56),h(2,ke,6,0,"div",57),o(3,"div",50)(4,"div",58)(5,"p",8),l(6),i(),o(7,"p",59),l(8),i()(),o(9,"div",60)(10,"div",61)(11,"p",8),l(12," Actualizacion de precio "),i(),o(13,"select",62),m("ngModelChange",function(t){g(e);let a=d();return _(a.productoForm.actualizarPrecio=t)}),o(14,"option",63),l(15," Mantener precio actual "),i(),o(16,"option",64),l(17," Actualizar precio "),i()()(),h(18,Ve,15,6)(19,Te,4,2,"div",65),o(20,"div",35)(21,"p",8)(22,"span",9),l(23," * "),i(),l(24," Cantidad "),i(),o(25,"input",66),m("keyup.enter",function(){g(e);let t=d();return _(t.submitForm())})("ngModelChange",function(t){g(e);let a=d();return _(a.productoForm.cantidad=t)}),i()()()(),h(26,ze,3,1,"div",67),i()()}if(r&2){let e=d();s(2),p("ngIf",e.estadoForm==="crear"),s(4),x(" ",e.productoSeleccionado==null?null:e.productoSeleccionado.descripcion," "),s(2),x(" ",e.productoSeleccionado==null?null:e.productoSeleccionado.unidadMedida.descripcion," "),s(5),p("disabled",e.ingreso.estado==="Completado")("ngModel",e.productoForm.actualizarPrecio),s(5),y(18,e.productoForm.actualizarPrecio==="true"?18:-1),s(),y(19,e.productoForm.actualizarPrecio==="false"?19:-1),s(6),p("disabled",e.ingreso.estado==="Completado")("ngModel",e.productoForm.cantidad),s(),p("ngIf",e.ingreso.estado==="Pendiente")}}function Ne(r,c){if(r&1){let e=f();o(0,"div",83)(1,"input",84),m("ngModelChange",function(t){g(e);let a=d();return _(a.filtroProveedor.parametro=t)})("focus",function(){g(e);let t=d();return _(t.showBuscadorProveedores=!0)}),i(),o(2,"button",85),m("click",function(){g(e);let t=d();return _(t.abrirNuevoProveedor())}),b(),o(3,"svg",26),C(4,"path",86),i()()()}if(r&2){let e=d();s(),p("ngModel",e.filtroProveedor.parametro)}}function Ge(r,c){if(r&1){let e=f();o(0,"div",87),C(1,"img",88),o(2,"div",89)(3,"p",8),l(4),i(),o(5,"p",90),l(6),i(),o(7,"button",91),m("click",function(){g(e);let t=d();return _(t.cancelarProveedor())}),l(8," Cancelar proveedor "),i()()()}if(r&2){let e=d();s(4),x(" ",e.proveedorSeleccionado.descripcion," "),s(2),E(" ",e.proveedorSeleccionado.tipo_identificacion," ",e.proveedorSeleccionado.identificacion," ")}}function Le(r,c){if(r&1){let e=f();o(0,"div",95),m("click",function(){let a=g(e).$implicit,u=d(2);return _(u.seleccionarProveedor(a))}),C(1,"img",96),o(2,"div",89)(3,"p",8),l(4),i(),o(5,"p",90),l(6),i()()()}if(r&2){let e=c.$implicit;s(4),x(" ",e.descripcion," "),s(2),E(" ",e.tipo_identificacion," ",e.identificacion," ")}}function Be(r,c){r&1&&(o(0,"div",97),l(1," No se encontraron proveedores "),i())}function $e(r,c){if(r&1){let e=f();o(0,"div",92)(1,"div",93)(2,"h1",8),l(3," Listado de proveedores "),i(),o(4,"button",94),m("click",function(){g(e);let t=d();return _(t.showBuscadorProveedores=!1)}),b(),o(5,"svg",26),C(6,"path",27),i()()(),S(),o(7,"div",50),k(8,Le,7,3,"div",98,be,!1,Be,2,0),w(11,"filtroProveedores"),i()()}if(r&2){let e=d();s(8),V(T(11,1,e.proveedores,e.filtroProveedor.parametro,"activo"))}}var Ue=(r,c)=>c.productoId;function Re(r,c){r&1&&(o(0,"p",118),l(1," Pendiente "),i())}function He(r,c){r&1&&(o(0,"p",119),l(1," Completado "),i())}function Oe(r,c){if(r&1){let e=f();o(0,"button",121),m("click",function(){g(e);let t=d(3);return _(t.completarIngreso())}),b(),o(1,"svg",26),C(2,"path",122),i()()}}function qe(r,c){if(r&1&&(o(0,"div"),h(1,Oe,3,0,"button",120),i()),r&2){let e=d(2);s(),p("ngIf",e.ingreso.estado==="Pendiente"&&e.productosCarrito.length>0)}}function Ze(r,c){if(r&1){let e=f();o(0,"button",124),m("click",function(){g(e);let t=d(3);return _(t.abrirModalIngreso())}),b(),o(1,"svg",26),C(2,"path",125),i()()}}function Je(r,c){if(r&1&&(o(0,"div"),h(1,Ze,3,0,"button",123),i()),r&2){let e=d(2);s(),p("ngIf",e.ingreso.estado==="Pendiente")}}function Ke(r,c){if(r&1&&(o(0,"p",110),l(1),i()),r&2){let e=d(2);s(),x(" Tel. ",e.ingreso==null?null:e.ingreso.proveedor.telefono," ")}}function Qe(r,c){if(r&1&&(o(0,"p",126)(1,"span",8),l(2," Usuario cierre: "),i(),l(3),i()),r&2){let e=d(2);s(3),E(" ",e.ingreso==null?null:e.ingreso.usuarioCompletado.apellido," ",e.ingreso==null?null:e.ingreso.usuarioCompletado.nombre," ")}}function We(r,c){if(r&1){let e=f();o(0,"button",128),m("click",function(){g(e);let t=d(3);return _(t.abrirModalProductos("crear"))}),b(),o(1,"svg",26),C(2,"path",86),i()()}}function Xe(r,c){if(r&1&&(o(0,"div"),h(1,We,3,0,"button",127),i()),r&2){let e=d(2);s(),p("ngIf",e.ingreso.estado==="Pendiente")}}function Ye(r,c){if(r&1){let e=f();o(0,"input",129),m("ngModelChange",function(t){g(e);let a=d(2);return _(a.filtros.productosCarrito=t)}),i()}if(r&2){let e=d(2);p("ngModel",e.filtros.productosCarrito)}}function et(r,c){if(r&1&&(o(0,"div",138)(1,"p",139),l(2),w(3,"moneda"),i(),b(),o(4,"svg",26),C(5,"path",140),i(),S(),o(6,"p",141),l(7),w(8,"moneda"),i()()),r&2){let e=d().$implicit;s(2),x(" $",P(3,2,e.precioVentaAnterior)," "),s(5),x(" $",P(8,4,e.precioVentaNuevo)," ")}}function tt(r,c){if(r&1&&(o(0,"p",135),l(1),w(2,"moneda"),i()),r&2){let e=d().$implicit;s(),x(" $",P(2,1,e.precioVentaAnterior)," ")}}function it(r,c){if(r&1){let e=f();o(0,"div",130),m("click",function(){let a=g(e).$implicit,u=d(2);return _(u.permisosAll&&u.abrirModalProductos("editar",a))}),o(1,"div",131)(2,"div",132),C(3,"img",133),i(),o(4,"div",134)(5,"p",8),l(6),i(),o(7,"p",135),l(8),i(),h(9,et,9,6,"div",136)(10,tt,3,3),i()(),o(11,"p",137)(12,"span",8),l(13," Cantidad: "),i(),l(14),i()()}if(r&2){let e=c.$implicit;s(6),x(" ",e.producto.descripcion," "),s(2),x(" ",e.producto.unidadMedida.descripcion," "),s(),y(9,e.actualizarPrecio?9:10),s(5),x(" ",e.cantidad," ")}}function ot(r,c){r&1&&(o(0,"p",142),l(1," No se encontraron productos "),i())}function rt(r,c){if(r&1&&(o(0,"div",99)(1,"div",100)(2,"div",83)(3,"button",101),b(),o(4,"svg",26),C(5,"path",71),i()(),S(),o(6,"div",89)(7,"h1",102),l(8," Detalles de ingreso "),i(),h(9,Re,2,0,"p",103)(10,He,2,0,"p",104),i()(),h(11,qe,2,1,"div",105),i(),o(12,"div",106)(13,"div")(14,"div",107)(15,"h2"),l(16," Datos generales "),i(),h(17,Je,2,1,"div",105),i(),o(18,"div",108)(19,"p",61)(20,"span",8),l(21," Nro de ingreso: "),i(),l(22),i(),o(23,"p",61)(24,"span",8),l(25," Fecha: "),i(),l(26),w(27,"fecha"),i()(),o(28,"p",109)(29,"span",8),l(30," Nro de factura: "),i(),l(31),i(),o(32,"div",109)(33,"div",73),C(34,"img",88),o(35,"div",89)(36,"p",8),l(37),i(),o(38,"p",110),l(39),i(),h(40,Ke,2,1,"p",111),i()()(),o(41,"p",109)(42,"span",8),l(43," Comentarios: "),i(),l(44),i(),o(45,"p",112)(46,"span",8),l(47," Usuario apertura: "),i(),l(48),i(),h(49,Qe,4,2,"p",113),i(),o(50,"div")(51,"div",107)(52,"div")(53,"h2",114),l(54," Listado de productos "),i(),o(55,"p",115),l(56),i()(),h(57,Xe,2,1,"div",105),i(),h(58,Ye,1,1,"input",116),o(59,"div",117),k(60,it,15,4,"div",143,Ue,!1,ot,2,0),w(63,"filtroIngresosProductos"),i()()()()),r&2){let e=d();s(9),p("ngIf",e.ingreso.estado==="Pendiente"),s(),p("ngIf",e.ingreso.estado==="Completado"),s(),p("appPermisos",e.permiso_escritura),s(6),p("appPermisos",e.permiso_escritura),s(5),x(" ",e.ingreso==null?null:e.ingreso.id," "),s(4),x(" ",(e.ingreso==null?null:e.ingreso.fechaIngreso)&&P(27,19,e.ingreso==null?null:e.ingreso.fechaIngreso)," "),s(5),x(" ",e.ingreso!=null&&e.ingreso.nroFactura?e.ingreso==null?null:e.ingreso.nroFactura:"Sin factura"," "),s(6),x(" ",e.ingreso==null?null:e.ingreso.proveedor.descripcion," "),s(2),E(" ",e.ingreso==null?null:e.ingreso.proveedor.tipo_identificacion," ",e.ingreso==null?null:e.ingreso.proveedor.identificacion," "),s(),p("ngIf",e.ingreso==null?null:e.ingreso.proveedor.telefono),s(4),x(" ",e.ingreso!=null&&e.ingreso.comentario?e.ingreso==null?null:e.ingreso.comentario:"Sin comentarios"," "),s(4),E(" ",e.ingreso==null?null:e.ingreso.creatorUser.apellido," ",e.ingreso==null?null:e.ingreso.creatorUser.nombre," "),s(),p("ngIf",(e.ingreso==null?null:e.ingreso.estado)==="Completado"),s(7),x(" Cantidad de producto: ",e.productosCarrito.length," "),s(),p("appPermisos",e.permiso_escritura),s(),p("ngIf",e.productosCarrito.length>0),s(2),V(T(63,21,e.productosCarrito,e.filtros.productosCarrito,""))}}var jt=(()=>{let c=class c{constructor(n,t,a,u,v,M,Se,Ie,we){this.dataService=n,this.authService=t,this.ingresosService=a,this.productosService=u,this.ingresosProductosService=v,this.alertService=M,this.activatedRoute=Se,this.router=Ie,this.proveedoresService=we,this.permiso_escritura=["INGRESOS_ALL"],this.permisosAll=!1,this.showModalIngreso=!1,this.showModalProductos=!1,this.showModalProveedor=!1,this.showBuscadorProveedores=!1,this.proveedores=[],this.proveedorSeleccionado=null,this.ingreso=null,this.productos=[],this.productoSeleccionado=null,this.relacionSeleccionada=null,this.productosCarrito=[],this.estadoForm="crear",this.productoForm={actualizarPrecio:"false",precioCompra:null,precioVenta:null,porcentajeGanancia:null,cantidad:null},this.proveedorForm={descripcion:"",tipo_identificacion:"DNI",identificacion:"",telefono:"",domicilio:""},this.filtros={productos:"",productosCarrito:""},this.filtroProveedor={parametro:""},this.ingresoForm={fechaIngreso:D(new Date,"yyyy-MM-dd"),nroFactura:"",comentario:""}}ngOnInit(){this.dataService.ubicacionActual="Dashboard - Detalles Ingreso",re.from(".gsap-contenido",{y:100,opacity:0,duration:.2}),this.alertService.loading(),this.verificacionPermisosTotales(),this.activatedRoute.params.subscribe({next:({id:n})=>{this.ingresosService.getIngreso(n).subscribe({next:({ingreso:t})=>{this.ingreso=t,this.productosCarrito=t.ingresosProductos,this.ordenarProductosCarrito(),this.reiniciarFormulario(),this.alertService.close()},error:({error:t})=>this.alertService.errorApi(t.message)})},error:({error:n})=>this.alertService.errorApi(n.message)})}verificacionPermisosTotales(){this.permisosAll=this.authService.usuario.permisos.includes("INGRESOS_ALL")||this.authService.usuario.role==="ADMIN_ROLE"}abrirModalIngreso(){this.proveedoresService.listarProveedores({direccion:"asc",columna:"descripcion",activo:"true"}).subscribe({next:({proveedores:n})=>{this.proveedores=n,this.showModalIngreso=!0,this.reiniciarFormulario()},error:({error:n})=>this.alertService.errorApi(n.message)})}abrirModalProductos(n="crear",t=null){this.estadoForm=n,this.filtros.productos="",this.estadoForm==="crear"?(this.alertService.loading(),this.productoSeleccionado=null,this.productosService.listarProductos({columna:"descripcion",direccion:"asc"}).subscribe({next:({productos:a})=>{this.productos=a,this.showModalProductos=!0,this.alertService.close()},error:({error:a})=>this.alertService.errorApi(a.message)})):(this.productoSeleccionado=t.producto,this.relacionSeleccionada=t,this.productoForm={actualizarPrecio:t.actualizarPrecio?"true":"false",precioCompra:t.precioCompra||t.precioCompra!==0?t.precioCompra:null,precioVenta:t.precioVentaNuevo||t.precioVentaNuevo!==0?t.precioVentaNuevo:null,porcentajeGanancia:t.porcentajeGanancia||t.porcentajeGanancia!==0?t.porcentajeGanancia:null,cantidad:t.cantidad||t.cantidad!==0?t.cantidad:null},this.showModalProductos=!0)}agregarProducto(){if(this.productoForm.actualizarPrecio==="true"&&(!this.productoForm.precioVenta||this.productoForm<=0))return this.alertService.info("Debe ingresar un precio de venta");if(!this.productoForm.cantidad)return this.alertService.info("Debe ingresar una cantidad");this.alertService.loading();let n={ingresoId:this.ingreso.id,productoId:this.productoSeleccionado.id,precioCompra:this.productoForm.precioCompra?this.productoForm.precioCompra:0,actualizarPrecio:this.productoForm.actualizarPrecio==="true",porcentajeGanancia:this.productoForm.actualizarPrecio==="true"?this.productoForm.porcentajeGanancia:0,precioVentaAnterior:this.productoSeleccionado.precioVenta,precioVentaNuevo:this.productoForm.actualizarPrecio==="true"?this.productoForm.precioVenta:this.productoSeleccionado.precioVenta,cantidad:this.productoForm.cantidad,creatorUserId:this.authService.usuario.userId};this.ingresosProductosService.nuevoIngresoProducto(n).subscribe({next:({relacion:t})=>{this.productosCarrito.push(t),this.reiniciarFormularioProducto(),this.ordenarProductosCarrito(),this.productoSeleccionado=null,this.alertService.close()},error:({error:t})=>this.alertService.errorApi(t.message)})}actualizarProducto(){if(this.productoForm.actualizarPrecio==="true"&&(!this.productoForm.precioVenta||this.productoForm<=0))return this.alertService.info("Debe ingresar un precio de venta");if(!this.productoForm.cantidad)return this.alertService.info("Debe ingresar una cantidad");this.alertService.loading();let n={precioCompra:this.productoForm.precioCompra?this.productoForm.precioCompra:0,actualizarPrecio:this.productoForm.actualizarPrecio==="true",porcentajeGanancia:this.productoForm.actualizarPrecio==="true"?this.productoForm.porcentajeGanancia:0,precioVentaAnterior:this.relacionSeleccionada.precioVentaAnterior,precioVentaNuevo:this.productoForm.actualizarPrecio==="true"?this.productoForm.precioVenta:this.relacionSeleccionada.precioVentaNuevo,cantidad:this.productoForm.cantidad,creatorUserId:this.authService.usuario.userId};this.ingresosProductosService.actualizarIngresoProducto(this.relacionSeleccionada.id,n).subscribe({next:({relacion:t})=>{this.productosCarrito=this.productosCarrito.map(a=>(a.id===t.id&&(a.precioCompra=t.precioCompra,a.actualizarPrecio=t.actualizarPrecio,a.porcentajeGanancia=t.porcentajeGanancia,a.precioVentaAnterior=t.precioVentaAnterior,a.precioVentaNuevo=t.precioVentaNuevo,a.cantidad=t.cantidad),a)),this.reiniciarFormularioProducto(),this.productoSeleccionado=null,this.showModalProductos=!1,this.alertService.close()},error:({error:t})=>this.alertService.errorApi(t.message)})}eliminarProducto(){this.alertService.question({msg:"Estas por eliminar un producto del ingreso",buttonText:"Eliminar"}).then(({isConfirmed:n})=>{n&&(this.alertService.loading(),this.ingresosProductosService.eliminarIngresoProducto(this.relacionSeleccionada.id).subscribe({next:()=>{this.productosCarrito=this.productosCarrito.filter(t=>t.id!==this.relacionSeleccionada.id),this.showModalProductos=!1,this.alertService.close()},error:({error:t})=>this.alertService.errorApi(t.message)}))})}actualizarIngreso(){this.alertService.loading();let n={fechaIngreso:this.ingresoForm.fechaIngreso,nroFactura:this.ingresoForm.nroFactura,comentario:this.ingresoForm.comentario,proveedorId:this.proveedorSeleccionado.id};this.ingresosService.actualizarIngreso(this.ingreso.id,n).subscribe({next:()=>{this.ingreso.fechaIngreso=D(se(new Date(this.ingresoForm.fechaIngreso),{days:2}),"yyyy-MM-dd"),this.ingreso.nroFactura=this.ingresoForm.nroFactura,this.ingreso.comentario=this.ingresoForm.comentario.toUpperCase(),this.ingreso.proveedor=this.proveedorSeleccionado,this.showModalIngreso=!1,this.alertService.close()},error:({error:t})=>this.alertService.errorApi(t.message)})}completarIngreso(){this.alertService.question({msg:"Estas por completar el ingreso",buttonText:"Completar"}).then(({isConfirmed:n})=>{n&&(this.alertService.loading(),this.ingresosService.completarIngreso(this.ingreso.id,{usuarioCompletadoId:this.authService.usuario.userId}).subscribe({next:()=>{this.router.navigateByUrl("/dashboard/ingresos"),this.alertService.close()},error:({error:t})=>this.alertService.errorApi(t.message)}))})}seleccionarProducto(n){this.productoSeleccionado=n,this.productoForm={actualizarPrecio:"false",precioCompra:null,precioVenta:n.precioVenta,porcentajeGanancia:n.porcentajeGanancia,cantidad:null},this.productoSeleccionado=n}deseleccionarProducto(){this.filtros.productos="",this.productoSeleccionado=null,this.reiniciarFormularioProducto()}abrirNuevoProveedor(){this.showModalIngreso=!1,this.showModalProveedor=!0,this.reiniciarFormularioProveedor()}cerrarNuevoProveedor(){this.showModalProveedor=!1,this.showModalIngreso=!0}nuevoProveedor(){if(this.verificacionDatosProveedor()!=="")return this.alertService.info(this.verificacionDatosProveedor());this.alertService.loading();let n=z(j({},this.proveedorForm),{creatorUserId:this.authService.usuario.userId});this.proveedoresService.nuevoProveedor(n).subscribe({next:({proveedor:t})=>{this.proveedorSeleccionado=t,this.proveedores.push(t),this.showModalProveedor=!1,this.showModalIngreso=!0,this.alertService.close()},error:({error:t})=>this.alertService.errorApi(t.message)})}verificacionDatosProveedor(){let{descripcion:n,identificacion:t}=this.proveedorForm,a="";return n.trim()===""?a="Debe colocar un Nombre o Razon Social":t.trim()===""&&(a="Debe colocar una identificaci\xF3n"),a}submitForm(){this.estadoForm==="crear"?this.agregarProducto():this.actualizarProducto()}seleccionarProveedor(n){this.proveedorSeleccionado=n,this.showBuscadorProveedores=!1}cancelarProveedor(){this.proveedorSeleccionado=null,this.filtroProveedor.parametro=""}calcularPrecioVenta(){if(this.productoForm.precioCompra==null||this.productoForm.porcentajeGanancia==null)return;let n=Number(this.productoForm.precioCompra),t=Number(this.productoForm.porcentajeGanancia),a=n+n*(t/100);this.productoForm.precioVenta=Number(a.toFixed(2))}ordenarProductosCarrito(){this.productosCarrito=this.productosCarrito.sort((n,t)=>n.producto.descripcion>t.producto.descripcion?1:n.producto.descripcion<t.producto.descripcion?-1:0)}reiniciarFormulario(){let{fechaIngreso:n,nroFactura:t,comentario:a}=this.ingreso;this.ingresoForm={fechaIngreso:D(n,"yyyy-MM-dd"),nroFactura:t,comentario:a},this.proveedorSeleccionado=this.ingreso.proveedor}reiniciarFormularioProducto(){this.productoForm={actualizarPrecio:"false",precioCompra:null,precioVenta:null,porcentajeGanancia:null,cantidad:null}}reiniciarFormularioProveedor(){this.proveedorForm={descripcion:"",tipo_identificacion:"DNI",identificacion:"",telefono:"",domicilio:""}}};c.\u0275fac=function(t){return new(t||c)(I(ae),I(K),I(ve),I(ge),I(Ce),I(ne),I(H),I(O),I(xe))},c.\u0275cmp=G({type:c,selectors:[["app-detalles-ingreso"]],standalone:!0,features:[B],decls:97,vars:17,consts:[[3,"showModal"],[3,"keyup.enter"],[1,"flex","items-center","justify-between","bg-gray-800","rounded-t","p-2"],[1,"text-white","px-2","py-1","rounded-t","text-lg"],["width","20","height","20","viewBox","0 0 24 24","fill","none","stroke","currentColor","stroke-width","2","stroke-linecap","round","stroke-linejoin","round",1,"cursor-pointer","feather","feather-x","text-white","mr-2",3,"click"],["x1","18","y1","6","x2","6","y2","18"],["x1","6","y1","6","x2","18","y2","18"],[1,"px-4","pt-2","max-h-96","overflow-y-auto","text-sm"],[1,"font-semibold"],[1,"text-red-500"],["placeholder","Ej. Moreno Lucas Omar","type","text",1,"input-generico","w-full","mt-2",3,"ngModel","ngModelChange"],[1,"w-full","md:flex","md:items-center","mt-3","pb-2"],[1,"md:w-1/2"],[1,"input-generico","w-full","mt-2",3,"ngModel","ngModelChange"],["value","DNI"],["value","CUIL"],["value","CUIT"],[1,"md:w-1/2","md:ml-2","mt-3","md:mt-0"],["placeholder","Ej. 34060398","type","text",1,"input-generico","w-full","mt-2",3,"ngModel","ngModelChange"],[1,"md:w-full","md:flex","md:items-center","mt-1","pb-2"],["placeholder","Ej. 2664869642","type","text",1,"input-generico","w-full","mt-2",3,"ngModel","ngModelChange"],["placeholder","Ej. Portugal 1030","type","text",1,"input-generico","w-full","mt-2",3,"ngModel","ngModelChange"],[1,"px-2","pb-2"],[1,"boton-crear","w-full","mt-4",3,"click"],["title","Eliminar producto","class","bg-red-700 hover:opacity-90 mr-2 text-white p-2 rounded border border-red-800",3,"click",4,"ngIf"],["title","Cerrar ventana",1,"bg-gray-50","text-gray-900","p-2","rounded","border","border-gray-400","hover:text-secondaryColor",3,"click"],["xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 24 24","stroke-width","1.5","stroke","currentColor",1,"w-5","h-5"],["stroke-linecap","round","stroke-linejoin","round","d","M6 18 18 6M6 6l12 12"],["class","p-2 text-sm"],[1,"p-2","text-sm"],[1,"w-full"],[1,"flex","flex-wrap","-mx-3","mb-4","mt-2"],[1,"w-full","px-3"],[1,"block","tracking-wide","text-gray-900","font-bold","mb-2"],["type","date",1,"input-generico","w-full",3,"ngModel","keyup.enter","ngModelChange"],[1,"mt-3"],["class","flex items-center"],["class","bg-white w-96 border h-max overflow-y-auto border-gray-400 fixed z-10 mt-2",4,"ngIf"],[1,"flex","flex-wrap","-mx-3","mb-4","mt-3"],["type","text","placeholder","Ej. Nro no obligatorio",1,"input-generico","w-full",3,"ngModel","keyup.enter","ngModelChange"],[1,"flex","flex-wrap","-mx-3","mb-4"],["type","text","placeholder","Comentario no obligatorio",1,"input-generico","w-full",3,"ngModel","keyup.enter","ngModelChange"],[1,"flex","flex-wrap","-mx-3"],[1,"w-full","px-3","flex","justify-end"],["type","button",1,"boton-editar","w-full",3,"click"],[1,"gsap-contenido"],["class","w-11/12 md:w-1/2 mx-auto mt-4",4,"ngIf"],["title","Eliminar producto",1,"bg-red-700","hover:opacity-90","mr-2","text-white","p-2","rounded","border","border-red-800",3,"click"],["stroke-linecap","round","stroke-linejoin","round","d","m14.74 9-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 0 1-2.244 2.077H8.084a2.25 2.25 0 0 1-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 0 0-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 0 1 3.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 0 0-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 0 0-7.5 0"],["type","text","placeholder","Buscar producto",1,"border","border-gray-400","w-full","p-2","rounded","mb-2","outline-none",3,"ngModel","ngModelChange"],[1,"max-h-96","overflow-y-auto"],[1,"border","border-gray-400","p-2","mb-2","cursor-pointer","hover:border-secondaryColor","hover:bg-purple-50",3,"click"],[1,"text-xs","text-gray-500"],[1,"text-xs","text-gray-500","mt-1"],[1,"p-2","text-gray-500","italic","border","border-gray-400","bg-gray-100"],["class","border border-gray-400 p-2 mb-2 cursor-pointer hover:border-secondaryColor hover:bg-purple-50"],[1,""],["class","flex items-center bg-gray-100 p-2 border border-gray-400",4,"ngIf"],[1,"mt-2","p-2","border","border-gray-400","bg-gray-50"],[1,"text-gray-500","text-xs","mt-1"],[1,"px-2","pb-2","mt-2"],[1,"mt-1"],[1,"input-generico","w-full","mt-2",3,"disabled","ngModel","ngModelChange"],["value","false"],["value","true"],["class","mt-3"],["type","number","placeholder","Ej. 10",1,"input-generico","mt-2","w-full",3,"disabled","ngModel","keyup.enter","ngModelChange"],["class","px-2 mt-2 pb-2",4,"ngIf"],[1,"flex","items-center","bg-gray-100","p-2","border","border-gray-400"],["title","Regresar",1,"hover:text-secondaryColor","p-2","border","border-gray-400","shadow","rounded",3,"click"],["xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 24 24","stroke-width","1.5","stroke","currentColor",1,"w-4","h-4"],["stroke-linecap","round","stroke-linejoin","round","d","M10.5 19.5 3 12m0 0 7.5-7.5M3 12h18"],[1,"font-semibold","ml-2"],[1,"flex","items-center","mt-2"],[1,"w-1/2"],["type","number","placeholder","Ej. 2000",1,"input-generico","mt-2","w-full",3,"disabled","ngModel","keyup.enter","keyup","ngModelChange"],[1,"w-1/2","ml-2"],["type","number","placeholder","Ej. 10",1,"input-generico","mt-2","w-full",3,"disabled","ngModel","keyup.enter","keyup","ngModelChange"],["type","number","placeholder","Ej. 3000",1,"input-generico","mt-2","w-full",3,"disabled","ngModel","keyup.enter","ngModelChange"],[1,"px-2","mt-2","pb-2"],["class","boton-crear w-full"],[1,"boton-crear","w-full",3,"click"],[1,"boton-editar","w-full",3,"click"],[1,"flex","items-center"],["type","text","placeholder","Buscar proveedor",1,"input-generico","w-full","mt-2",3,"ngModel","ngModelChange","focus"],["title","Nuevo proveedor",1,"p-2","rounded","bg-gray-100","border","border-gray-400","hover:text-secondaryColor","ml-2","mt-2",3,"click"],["stroke-linecap","round","stroke-linejoin","round","d","M12 4.5v15m7.5-7.5h-15"],[1,"p-2","border","border-gray-400","mt-2","flex","items-center"],["src","assets/svg/proveedor.svg","alt","proveedor.svg",1,"w-14"],[1,"ml-2"],[1,"text-gray-500","text-xs"],[1,"bg-red-100","text-xs","text-red-500","border","border-red-300","p-1","mt-1","font-semibold","rounded",3,"click"],[1,"bg-white","w-96","border","h-max","overflow-y-auto","border-gray-400","fixed","z-10","mt-2"],[1,"bg-gray-100","p-2","border-b","border-gray-400","flex","items-center","justify-between"],[3,"click"],[1,"flex","items-center","p-2","border-b","border-gray-300","hover:bg-gray-50","cursor-pointer",3,"click"],["src","assets/svg/proveedor.svg","alt","proveedor.svg",1,"w-12"],[1,"p-2","text-gray-500","text-center","italic"],["class","flex items-center p-2 border-b border-gray-300 hover:bg-gray-50 cursor-pointer"],[1,"w-11/12","md:w-1/2","mx-auto","mt-4"],[1,"bg-gray-800","flex","items-center","justify-between","text-white","w-full","p-2","rounded-t"],["routerLink","/dashboard/ingresos","title","Regresar",1,"hover:text-secondaryColor"],[1,"text-xl"],["class","w-max p-1 mt-1 rounded bg-yellow-100 text-black text-xs border-yellow-300",4,"ngIf"],["class","w-max p-1 mt-1 rounded bg-green-100 text-black text-xs border-green-300",4,"ngIf"],[4,"appPermisos"],[1,"text-sm","p-2","border","border-gray-400","border-t-0"],[1,"bg-gray-100","p-2","flex","items-center","justify-between","w-full","border","border-gray-400","mt-2"],[1,"mt-2","px-2","py-3","border","border-gray-400","w-full","flex","items-center","justify-between"],[1,"px-2","py-3","border","border-t-0","border-gray-400"],[1,"text-xs","text-gray-600","mt-1"],["class","text-xs text-gray-600 mt-1",4,"ngIf"],[1,"px-2","py-3","bg-yellow-50","border","border-t-0","border-gray-400"],["class","px-2 py-3 bg-green-50 border border-t-0 border-gray-400",4,"ngIf"],[1,"text-lg"],[1,"mt-1","text-xs","font-semibold"],["type","text","class","input-generico w-full mt-3","placeholder","Buscar producto",3,"ngModel","ngModelChange",4,"ngIf"],[1,"max-h-96","overflow-y-auto","mt-1"],[1,"w-max","p-1","mt-1","rounded","bg-yellow-100","text-black","text-xs","border-yellow-300"],[1,"w-max","p-1","mt-1","rounded","bg-green-100","text-black","text-xs","border-green-300"],["title","Completar ingreso","class","p-2 bg-gray-100 mr-1 text-black hover:text-secondaryColor border-gray-300 rounded",3,"click",4,"ngIf"],["title","Completar ingreso",1,"p-2","bg-gray-100","mr-1","text-black","hover:text-secondaryColor","border-gray-300","rounded",3,"click"],["stroke-linecap","round","stroke-linejoin","round","d","m4.5 12.75 6 6 9-13.5"],["title","Editar datos","class","boton-editar",3,"click",4,"ngIf"],["title","Editar datos",1,"boton-editar",3,"click"],["stroke-linecap","round","stroke-linejoin","round","d","m16.862 4.487 1.687-1.688a1.875 1.875 0 1 1 2.652 2.652L6.832 19.82a4.5 4.5 0 0 1-1.897 1.13l-2.685.8.8-2.685a4.5 4.5 0 0 1 1.13-1.897L16.863 4.487Zm0 0L19.5 7.125"],[1,"px-2","py-3","bg-green-50","border","border-t-0","border-gray-400"],["title","Agregar producto","class","boton-crear",3,"click",4,"ngIf"],["title","Agregar producto",1,"boton-crear",3,"click"],["type","text","placeholder","Buscar producto",1,"input-generico","w-full","mt-3",3,"ngModel","ngModelChange"],[1,"border","flex","items-center","justify-between","border-gray-400","mt-2","p-2","hover:border-secondaryColor","hover:bg-purple-50","cursor-pointer",3,"click"],[1,"flex","items-center","justify-center"],[1,"bg-green-50","border","border-green-700","p-2","rounded","text-green-700"],["src","assets/svg/producto.svg","alt","producto.svg",1,"w-14"],[1,"ml-3"],[1,"text-gray-600","text-xs","mt-1","italic"],["class","flex items-center mt-1"],[1,"mt-1","w-max","p-2","text-xs","bg-gray-100","border","border-gray-400","rounded"],[1,"flex","items-center","mt-1"],[1,"text-xs","mt-1","w-max","bg-orange-100","p-1","border","border-orange-400"],["stroke-linecap","round","stroke-linejoin","round","d","M17.25 8.25 21 12m0 0-3.75 3.75M21 12H3"],[1,"text-xs","mt-1","ml-1","w-max","bg-green-100","p-1","border","border-green-400"],[1,"p-2","text-gray-500","mt-2","italic","border","bg-gray-50","border-gray-400"],["class","border flex items-center justify-between border-gray-400 mt-2 p-2 hover:border-secondaryColor hover:bg-purple-50 cursor-pointer"]],template:function(t,a){t&1&&(o(0,"app-modal",0)(1,"div",1),m("keyup.enter",function(){return a.nuevoProveedor()}),o(2,"div",2)(3,"h1",3),l(4," Creando proveedor "),i(),b(),o(5,"svg",4),m("click",function(){return a.cerrarNuevoProveedor()}),C(6,"line",5)(7,"line",6),i()(),S(),o(8,"div",7)(9,"div")(10,"p",8)(11,"span",9),l(12," * "),i(),l(13," Nombre o Razon social "),i(),o(14,"input",10),m("ngModelChange",function(v){return a.proveedorForm.descripcion=v}),i()(),o(15,"div",11)(16,"div",12)(17,"p",8)(18,"span",9),l(19," * "),i(),l(20," Tipo de identificaci\xF3n "),i(),o(21,"select",13),m("ngModelChange",function(v){return a.proveedorForm.tipo_identificacion=v}),o(22,"option",14),l(23," DNI "),i(),o(24,"option",15),l(25," CUIL "),i(),o(26,"option",16),l(27," CUIT "),i()()(),o(28,"div",17)(29,"p",8)(30,"span",9),l(31," * "),i(),l(32," Identificaci\xF3n "),i(),o(33,"input",18),m("ngModelChange",function(v){return a.proveedorForm.identificacion=v}),i()()(),o(34,"div",19)(35,"div",12)(36,"p",8),l(37," Tel\xE9fono "),i(),o(38,"input",20),m("ngModelChange",function(v){return a.proveedorForm.telefono=v}),i()(),o(39,"div",17)(40,"p",8),l(41," Domicilio "),i(),o(42,"input",21),m("ngModelChange",function(v){return a.proveedorForm.domicilio=v}),i()()()(),o(43,"div",22)(44,"button",23),m("click",function(){return a.nuevoProveedor()}),l(45," Crear proveedor "),i()()()(),o(46,"app-modal",0)(47,"div",2)(48,"h1",3),l(49),i(),o(50,"div"),h(51,Me,3,0,"button",24),o(52,"button",25),m("click",function(){return a.showModalProductos=!1}),b(),o(53,"svg",26),C(54,"path",27),i()()()(),h(55,Fe,7,6,"div",28)(56,Ae,27,10),i(),S(),o(57,"app-modal",0)(58,"div",2)(59,"h1",3),l(60," Actualizando datos "),i(),b(),o(61,"svg",4),m("click",function(){return a.showModalIngreso=!1}),C(62,"line",5)(63,"line",6),i()(),S(),o(64,"div",29)(65,"div",30)(66,"div",31)(67,"div",32)(68,"label",33)(69,"span",9),l(70," * "),i(),l(71," Fecha de ingreso "),i(),o(72,"input",34),m("keyup.enter",function(){return a.actualizarIngreso()})("ngModelChange",function(v){return a.ingresoForm.fechaIngreso=v}),i()()(),o(73,"div",35)(74,"p",8)(75,"span",9),l(76," * "),i(),l(77," Proveedor "),i(),h(78,Ne,5,1,"div",36)(79,Ge,9,3)(80,$e,12,5,"div",37),i(),o(81,"div",38)(82,"div",32)(83,"label",33),l(84," Nro de factura "),i(),o(85,"input",39),m("keyup.enter",function(){return a.actualizarIngreso()})("ngModelChange",function(v){return a.ingresoForm.nroFactura=v}),i()()(),o(86,"div",40)(87,"div",32)(88,"label",33),l(89," Comentarios "),i(),o(90,"input",41),m("keyup.enter",function(){return a.actualizarIngreso()})("ngModelChange",function(v){return a.ingresoForm.comentario=v}),i()()(),o(91,"div",42)(92,"div",43)(93,"button",44),m("click",function(){return a.actualizarIngreso()}),l(94," Actualizar "),i()()()()()(),o(95,"div",45),h(96,rt,64,25,"div",46),i()),t&2&&(p("showModal",a.showModalProveedor),s(14),p("ngModel",a.proveedorForm.descripcion),s(7),p("ngModel",a.proveedorForm.tipo_identificacion),s(12),p("ngModel",a.proveedorForm.identificacion),s(5),p("ngModel",a.proveedorForm.telefono),s(4),p("ngModel",a.proveedorForm.domicilio),s(4),p("showModal",a.showModalProductos),s(3),x(" ",a.estadoForm==="crear"?"Agregando producto":"Editando producto"," "),s(2),p("ngIf",a.estadoForm==="editar"&&a.ingreso.estado==="Pendiente"),s(4),y(55,a.productoSeleccionado?56:55),s(2),p("showModal",a.showModalIngreso),s(15),p("ngModel",a.ingresoForm.fechaIngreso),s(6),y(78,a.proveedorSeleccionado?79:78),s(2),p("ngIf",a.showBuscadorProveedores),s(5),p("ngModel",a.ingresoForm.nroFactura),s(5),p("ngModel",a.ingresoForm.comentario),s(6),p("ngIf",a.ingreso))},dependencies:[U,$,oe,te,ie,Q,Y,ee,W,X,ce,de,pe,Z,q,me,ue,fe,_e,le],encapsulation:2});let r=c;return r})();export{jt as default};
