import{a as fe,b as xe}from"./chunk-CAYDV5JR.js";import{a as Ce}from"./chunk-GO74AM6A.js";import{a as me}from"./chunk-4PVDMTCU.js";import{a as ge,b as he}from"./chunk-LQQHBQB6.js";import{a as ve,b as H}from"./chunk-L5BLIFW3.js";import{a as re}from"./chunk-22XSY4EJ.js";import{a as J,b as _e}from"./chunk-H74VPA6E.js";import{a as Y}from"./chunk-AZJWBWL5.js";import{a as $}from"./chunk-55FSNNZ2.js";import{c as Q,d as pe}from"./chunk-6M6LJACB.js";import{c as ue}from"./chunk-U34JSWL2.js";import{a as j,c as D,e as O,g as B,j as ae,k as oe,l as ne,m as le,o as G}from"./chunk-B2HCO65P.js";import{a as se}from"./chunk-BPTFILPP.js";import{a as de,b as ce}from"./chunk-5N72VQB2.js";import"./chunk-VSPTT5AX.js";import{d as ee,e as N,g as I,p as te,t as A,u as ie,v as L}from"./chunk-BJBUZF5B.js";import{$a as c,Bb as F,Gb as b,Hb as S,Jb as X,Ra as l,Sa as w,Va as W,ba as k,cb as y,eb as T,fb as V,ga as v,gb as e,ha as g,hb as t,ia as f,ib as x,ja as R,lb as C,pb as d,qb as p,ub as o,wb as _,xb as E}from"./chunk-GQGQXF3A.js";var Ve=(s,m)=>m.id;function ke(s,m){if(s&1){let r=C();e(0,"div",9),d("click",function(){let i=v(r).$implicit,u=p(2);return g(u.seleccionarProducto(i))}),e(1,"p",10),o(2),t(),e(3,"p",11),o(4),b(5,"moneda"),t()()}if(s&2){let r=m.$implicit;l(2),_(" ",r.descripcion," "),l(2),E(" $",S(5,3,r.precioVenta)," x ",r.unidadMedida.descripcion," ")}}function Fe(s,m){s&1&&(e(0,"div",12)(1,"p",13),o(2," No se encontraron productos "),t()())}function Ne(s,m){if(s&1){let r=C();f(),R(),e(0,"div",6)(1,"div")(2,"input",7),d("ngModelChange",function(a){v(r);let i=p();return g(i.filtroProductos.parametro=a)}),t()(),e(3,"div",8),T(4,ke,6,5,"div",14,Ve,!1,Fe,3,0),b(7,"filtroProductos"),t()()}if(s&2){let r=p();l(2),c("ngModel",r.filtroProductos.parametro),l(2),V(X(7,2,r.productos,r.filtroProductos.parametro,"true"))}}function Ie(s,m){if(s&1){let r=C();f(),R(),e(0,"div",6)(1,"div",15)(2,"p",10),o(3),t(),e(4,"p",11),o(5),b(6,"moneda"),t()(),e(7,"div",16)(8,"input",17),d("keyup.enter",function(){v(r);let a=p();return g(a.agregarProducto())})("ngModelChange",function(a){v(r);let i=p();return g(i.cantidad=a)}),t(),e(9,"button",18),d("click",function(){v(r);let a=p();return g(a.agregarProducto())}),f(),e(10,"svg",3),x(11,"path",19),t()(),R(),e(12,"button",20),d("click",function(){v(r);let a=p();return g(a.deseleccionarProducto())}),f(),e(13,"svg",3),x(14,"path",4),t()()()()}if(s&2){let r=p();l(3),_(" ",r.productoSeleccionado==null?null:r.productoSeleccionado.descripcion," "),l(2),E(" $",S(6,4,r.productoSeleccionado==null?null:r.productoSeleccionado.precioVenta)," x ",r.productoSeleccionado==null||r.productoSeleccionado.unidadMedida==null?null:r.productoSeleccionado.unidadMedida.descripcion," "),l(3),c("ngModel",r.cantidad)}}var be=(()=>{let m=class m{constructor(n,a){this.productosService=n,this.alertService=a,this.insertEvent=new W,this.productoSeleccionado=null,this.productos=[],this.cantidad=null,this.filtroProductos={parametro:""}}ngOnInit(){this.inicializacion()}inicializacion(){this.productosService.listarProductos({}).subscribe({next:({productos:n})=>{this.productos=n},error:({error:n})=>this.alertService.errorApi(n.message)})}seleccionarProducto(n){this.productoSeleccionado=n}deseleccionarProducto(){this.productoSeleccionado=null,this.reiniciarForm()}agregarProducto(){if(!this.cantidad||this.cantidad<0)return this.alertService.info("Debe colocar una cantidad v\xE1lida");let n={producto:this.productoSeleccionado,cantidad:this.cantidad,precioTotal:this.cantidad*this.productoSeleccionado.precioVenta};this.insertEvent.emit(n),this.productoSeleccionado=null,this.reiniciarForm()}reiniciarForm(){this.filtroProductos.parametro="",this.cantidad=null}};m.\u0275fac=function(a){return new(a||m)(w(H),w(L))},m.\u0275cmp=k({type:m,selectors:[["app-agregar-producto"]],outputs:{insertEvent:"insertEvent"},standalone:!0,features:[F],decls:10,vars:3,consts:[[3,"showModal"],[1,"text-white","text-lg","flex","p-2","rounded-t","items-center","bg-gray-900","justify-between"],[3,"click"],["xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 24 24","stroke-width","1.5","stroke","currentColor",1,"w-5","h-5"],["stroke-linecap","round","stroke-linejoin","round","d","M6 18 18 6M6 6l12 12"],["class","p-2",4,"ngIf"],[1,"p-2"],["type","text","placeholder","Buscar producto",1,"input-generico","w-64","text-sm",3,"ngModel","ngModelChange"],[1,"max-h-96","overflow-y-auto"],[1,"p-2","border","text-sm","mt-2","border-gray-400","hover:border-secondaryColor","hover:bg-purple-50","cursor-pointer",3,"click"],[1,"font-semibold"],[1,"text-gray-500","text-xs"],[1,"pt-3"],[1,"text-gray-500","text-sm","italic","p-2","bg-gray-50","border","border-gray-400","rounded","w-full"],["class","p-2 border text-sm mt-2 border-gray-400 hover:border-secondaryColor hover:bg-purple-50 cursor-pointer"],[1,"ml-1"],[1,"flex","items-center","mt-2"],["type","number","placeholder","Cantidad",1,"input-generico","w-46","text-sm",3,"ngModel","keyup.enter","ngModelChange"],["title","Agregar producto",1,"bg-green-700","hover:opacity-90","text-white","p-2","ml-2","rounded",3,"click"],["stroke-linecap","round","stroke-linejoin","round","d","m4.5 12.75 6 6 9-13.5"],["title","Regresar",1,"bg-red-700","hover:opacity-90","ml-2","text-white","p-2","rounded",3,"click"]],template:function(a,i){a&1&&(e(0,"app-modal",0)(1,"div")(2,"div",1)(3,"h1"),o(4," Listado de productos "),t(),e(5,"button",2),d("click",function(){return i.productosService.showModalAgregarProducto=!1}),f(),e(6,"svg",3),x(7,"path",4),t()()(),y(8,Ne,8,6,"div",5)(9,Ie,15,6,"div",5),t()()),a&2&&(c("showModal",i.productosService.showModalAgregarProducto),l(8),c("ngIf",!i.productoSeleccionado),l(),c("ngIf",i.productoSeleccionado))},dependencies:[I,N,G,j,B,D,O,$,A,ve,Y],encapsulation:2});let s=m;return s})();var Ae=(s,m)=>m.producto.id;function je(s,m){s&1&&(e(0,"button",82),f(),e(1,"svg",5),x(2,"path",83),t()())}function De(s,m){if(s&1){let r=C();e(0,"button",84),d("click",function(){v(r);let a=p();return g(a.cambiarImprimirTicket())}),f(),e(1,"svg",85),x(2,"path",86),t(),R(),e(3,"p",87),o(4," No imprimir ticket "),t()()}}function Oe(s,m){if(s&1&&(e(0,"option",88),o(1),t()),s&2){let r=m.$implicit;c("value",r.valor),l(),_(" ",r.descripcion," ")}}function Be(s,m){if(s&1){let r=C();e(0,"div",89)(1,"input",90),d("ngModelChange",function(a){v(r);let i=p();return g(i.pedidosYaComprobante=a)}),t()()}if(s&2){let r=p();l(),c("ngModel",r.pedidosYaComprobante)}}function Ge(s,m){if(s&1){let r=C();e(0,"button",91),d("click",function(){v(r);let a=p();return g(a.cambiarMultiplesFormasPago())}),o(1," Multiples formas de pago "),t()}}function Le(s,m){if(s&1){let r=C();e(0,"div",3)(1,"input",92),d("keyup.enter",function(){v(r);let a=p();return g(a.agregarFormaPago())})("ngModelChange",function(a){v(r);let i=p();return g(i.valorFormaPago=a)}),t(),e(2,"button",93),d("click",function(){v(r);let a=p();return g(a.agregarFormaPago())}),f(),e(3,"svg",5),x(4,"path",76),t()(),R(),e(5,"button",94),d("click",function(){v(r);let a=p();return g(a.cambiarMultiplesFormasPago())}),f(),e(6,"svg",5),x(7,"path",86),t()()()}if(s&2){let r=p();l(),c("ngModel",r.valorFormaPago)}}var $e=(s,m)=>m.descripcion;function Ye(s,m){if(s&1){let r=C();e(0,"div",97)(1,"p",98),o(2),t(),e(3,"p",98),o(4),b(5,"moneda"),t(),e(6,"button",99),d("click",function(){let i=v(r).$implicit,u=p(2);return g(u.eliminarFormaPago(i.descripcion))}),f(),e(7,"svg",5),x(8,"path",100),t()()()}if(s&2){let r=m.$implicit;l(2),_(" ",r.descripcion," "),l(2),_(" $",S(5,2,r.valor)," ")}}function He(s,m){s&1&&(e(0,"div",101),o(1," Agregar al menos una forma de pago "),t())}function Ue(s,m){if(s&1&&(e(0,"div",95)(1,"h1",96),o(2," Formas de pago agregadas "),t(),e(3,"div"),T(4,Ye,9,4,"div",102,$e,!1,He,2,0),t()()),s&2){let r=p();l(4),V(r.formasPago)}}function ze(s,m){if(s&1){let r=C();e(0,"button",103),d("click",function(){v(r);let a=p();return g(a.abrirCompletarReserva())}),f(),e(1,"svg",5),x(2,"path",104),t()()}}function qe(s,m){if(s&1){let r=C();e(0,"div",3)(1,"input",105),d("keyup.enter",function(){v(r);let a=p();return g(a.buscarCliente())})("ngModelChange",function(a){v(r);let i=p();return g(i.identificacionCliente=a)}),t(),e(2,"button",106),d("click",function(){v(r);let a=p();return g(a.buscarCliente())}),f(),e(3,"svg",5),x(4,"path",107),t()()()}if(s&2){let r=p();l(),c("ngModel",r.identificacionCliente)}}function Ze(s,m){if(s&1&&(e(0,"p",110),o(1),t()),s&2){let r=p(2);l(),_(" Tel. ",r.clienteSeleccionado.telefono," ")}}function Qe(s,m){if(s&1){let r=C();e(0,"div")(1,"div",108),x(2,"img",109),e(3,"div")(4,"p",14),o(5),t(),e(6,"p",110),o(7),t(),y(8,Ze,2,1,"p",111),t()(),e(9,"button",112),d("click",function(){v(r);let a=p();return g(a.deseleccionarCliente())}),o(10," Cancelar seleccion "),t()()}if(s&2){let r=p();l(5),_(" ",r.clienteSeleccionado.descripcion," "),l(2),E(" ",r.clienteSeleccionado.tipo_identificacion," ",r.clienteSeleccionado.identificacion," "),l(),c("ngIf",r.clienteSeleccionado.telefono)}}function Je(s,m){if(s&1){let r=C();e(0,"div",113)(1,"div",3),x(2,"img",114),e(3,"div",115)(4,"p",116),o(5),t(),e(6,"p",117),o(7),b(8,"moneda"),t(),e(9,"p",117),o(10),t(),e(11,"p",118),o(12),b(13,"moneda"),t()()(),e(14,"div",119)(15,"button",120),d("click",function(){let i=v(r).$implicit,u=p();return g(u.eliminarProducto(i))}),f(),e(16,"svg",121),x(17,"path",86),t()()()()}if(s&2){let r=m.$implicit;l(5),_(" ",r.producto.descripcion," "),l(2),E(" $",S(8,5,r.producto.precioVenta)," x ",r.producto.unidadMedida.descripcion," "),l(3),_(" Cantidad: ",r.cantidad," "),l(2),_(" Precio: $",S(13,7,r.precioTotal)," ")}}function Ke(s,m){if(s&1){let r=C();e(0,"div")(1,"p",122),o(2," Todavia no se cargo ningun producto "),t(),e(3,"button",123),d("click",function(){v(r);let a=p();return g(a.abrirModalAgregarProducto())}),o(4," Agregar producto "),t()()}}function We(s,m){if(s&1){let r=C();e(0,"div")(1,"textarea",124),d("ngModelChange",function(a){v(r);let i=p();return g(i.dataReserva.observaciones=a)}),t()()}if(s&2){let r=p();l(),c("ngModel",r.dataReserva.observaciones)}}function Xe(s,m){if(s&1){let r=C();e(0,"div")(1,"div",125)(2,"div",126)(3,"div",127)(4,"p",14)(5,"span",128),o(6," * "),t(),o(7," Relleno 1 "),t(),e(8,"input",129),d("ngModelChange",function(a){v(r);let i=p();return g(i.dataReserva.tortaRelleno1=a)}),t()(),e(9,"div",130)(10,"p",14),o(11," Relleno 2 "),t(),e(12,"input",131),d("ngModelChange",function(a){v(r);let i=p();return g(i.dataReserva.tortaRelleno2=a)}),t()()()(),e(13,"div",132)(14,"div",126)(15,"div",127)(16,"p",14),o(17," Relleno 3 "),t(),e(18,"input",133),d("ngModelChange",function(a){v(r);let i=p();return g(i.dataReserva.tortaRelleno3=a)}),t()(),e(19,"div",130)(20,"p",14)(21,"span",128),o(22," * "),t(),o(23," Forma "),t(),e(24,"input",134),d("ngModelChange",function(a){v(r);let i=p();return g(i.dataReserva.tortaForma=a)}),t()()()(),e(25,"div",135)(26,"div",126)(27,"div",127)(28,"p",14)(29,"span",128),o(30," * "),t(),o(31," Peso (kg) "),t(),e(32,"input",136),d("ngModelChange",function(a){v(r);let i=p();return g(i.dataReserva.tortaPeso=a)}),t()(),e(33,"div",137)(34,"p",14)(35,"span",128),o(36," * "),t(),o(37," Cobertura "),t(),e(38,"input",129),d("ngModelChange",function(a){v(r);let i=p();return g(i.dataReserva.tortaCobertura=a)}),t()()()(),e(39,"div",138)(40,"p",14),o(41," Detalles de torta "),t(),e(42,"textarea",139),d("ngModelChange",function(a){v(r);let i=p();return g(i.dataReserva.tortaDetalles=a)}),t()(),e(43,"div",140)(44,"p",14),o(45," Observaciones generales (No impacta en comprobante) "),t(),e(46,"textarea",141),d("ngModelChange",function(a){v(r);let i=p();return g(i.dataReserva.observaciones=a)}),t()()()}if(s&2){let r=p();l(8),c("ngModel",r.dataReserva.tortaRelleno1),l(4),c("ngModel",r.dataReserva.tortaRelleno2),l(6),c("ngModel",r.dataReserva.tortaRelleno3),l(6),c("ngModel",r.dataReserva.tortaForma),l(8),c("ngModel",r.dataReserva.tortaPeso),l(6),c("ngModel",r.dataReserva.tortaCobertura),l(4),c("ngModel",r.dataReserva.tortaDetalles),l(4),c("ngModel",r.dataReserva.observaciones)}}var et=ie.base_url,Dt=(()=>{let m=class m{constructor(n,a,i,u,h,U,P,z,q){this.alertService=n,this.productosService=a,this.dataService=i,this.clientesService=u,this.authService=h,this.ventasService=U,this.reservasService=P,this.ventasReservasService=z,this.router=q,this.fechaActual=new Date,this.showModalCompletar=!1,this.showModalGenerarReserva=!1,this.carritoProductos=[],this.totalPagado=0,this.faltaPagar=0,this.multiplesFormasPago=!1,this.formasPago=[],this.dataReserva={fechaReserva:Q(new Date,"yyyy-MM-dd"),fechaEntrega:"",horaEntrega:"",usuarioCreador:"",fechaFinalizacion:"",observaciones:"",precioTotal:0,adelanto:null,horasAntes:"3",fechaAlerta:"",tipoObservacion:"General",tortaRelleno1:"",tortaRelleno2:"",tortaRelleno3:"",tortaForma:"",tortaPeso:null,tortaCobertura:"",tortaDetalles:""},this.comprobante="Normal",this.imprimirTicket=!0,this.totalBalanza=0,this.totalNoBalanza=0,this.pedidosYaComprobante="",this.adicionalCredito=0,this.valorFormaPago=null,this.formaPago="Efectivo",this.porcentajePorCredito=he.porcentajePorCredito,this.precioTotalVenta=0,this.precioTotalLimpio=0,this.vuelto=null,this.pagaCon=null,this.formasPagoArray=J,this.clienteSeleccionado=null,this.identificacionCliente="",this.filtroProductos={parametro:""}}ngOnInit(){this.dataService.ubicacionActual="Dashboard - Nueva reserva",se.from(".gsap-contenido",{y:100,opacity:0,duration:.2})}abrirCompletarReserva(){let{tipoObservacion:n,tortaRelleno1:a,tortaForma:i,tortaPeso:u,tortaCobertura:h}=this.dataReserva;if(n==="Torta"&&a.trim()==="")return this.alertService.info("Debe colocar el primer relleno de la torta");if(n==="Torta"&&i.trim()==="")return this.alertService.info("Debe colocar la forma de la torta");if(n==="Torta"&&!u)return this.alertService.info("Debe colocar el peso de la torta");if(n==="Torta"&&h.trim()==="")return this.alertService.info("Debe colocar la cobertura de la torta");this.showModalGenerarReserva=!0,this.dataReserva.adelanto=this.dataReserva.precioTotal/2,this.calcularFaltaPagarReserva()}regresarReserva(){this.showModalCompletar=!1,this.showModalGenerarReserva=!0}calcularFaltaPagarReserva(){this.faltaPagar=this.dataReserva.precioTotal-this.dataReserva.adelanto}abrirAbmCliente(){this.clientesService.abrirAbm("crear")}buscarCliente(){if(this.identificacionCliente.trim()==="")return this.alertService.info("Ingrese una identificaci\xF3n");this.alertService.loading(),this.clientesService.getIdentificacion(this.identificacionCliente).subscribe({next:({cliente:n})=>{n?this.seleccionarCliente(n):this.abrirAbmCliente(),this.alertService.close()},error:({error:n})=>this.alertService.errorApi(n.message)})}seleccionarCliente(n){this.clienteSeleccionado=n,this.identificacionCliente="",this.alertService.close()}deseleccionarCliente(){this.clienteSeleccionado=null}abrirModalAgregarProducto(){this.productosService.showModalAgregarProducto=!0}agregarProducto(n){if(this.carritoProductos.find(u=>u.producto.id===n.producto.id))return this.alertService.info("El producto ya se encuentra cargado");let i={producto:n.producto,cantidad:n.cantidad,precioTotal:n.precioTotal,precioUnitario:n.producto.precioVenta};this.carritoProductos=[...this.carritoProductos,i],this.calcularPrecioTotal()}eliminarProducto(n){this.carritoProductos=this.carritoProductos.filter(a=>a.producto.id!==n.producto.id),this.calcularPrecioTotal()}calcularPrecioTotal(){this.dataReserva.precioTotal=0,this.carritoProductos.forEach(n=>this.dataReserva.precioTotal+=n.precioTotal)}abrirCompletarVenta(){if(!this.dataReserva.fechaEntrega){this.alertService.info("Debe colocar una fecha de entrega");return}if(!this.dataReserva.horaEntrega){this.alertService.info("Debe colocar una hora de entrega");return}if(!this.dataReserva.usuarioCreador){this.alertService.info("Debe colocar el nombre de quien genera el reserva");return}if(!this.dataReserva.adelanto){this.alertService.info("Debe colocar el valor de la se\xF1a");return}this.showModalCompletar=!0,this.precioTotalLimpio=this.dataReserva.adelanto,this.precioTotalVenta=this.dataReserva.adelanto,this.showModalGenerarReserva=!1,this.calcularPrecioFinal()}cambiarFormaPago(){this.multiplesFormasPago||this.calcularPrecioFinal()}cambiarImprimirTicket(){this.imprimirTicket=!this.imprimirTicket}calcularVuelto(){this.vuelto=this.pagaCon-this.precioTotalVenta,this.vuelto<0&&(this.vuelto=null)}calcularPrecioFinal(){this.precioTotalVenta=this.dataReserva.adelanto,this.precioTotalLimpio=this.dataReserva.adelanto,this.totalBalanza=0,this.totalNoBalanza=0,this.adicionalCredito=0,this.formaPago==="Credito"&&!this.multiplesFormasPago&&(this.adicionalCredito=this.precioTotalVenta*(this.porcentajePorCredito/100),this.precioTotalVenta+=this.adicionalCredito),this.precioTotalVenta=Math.round(this.precioTotalVenta*100)/100,this.precioTotalLimpio=Math.round(this.precioTotalLimpio*100)/100,this.totalBalanza=Math.round(this.totalBalanza*100)/100,this.totalNoBalanza=Math.round(this.totalNoBalanza*100)/100,this.adicionalCredito=Math.round(this.adicionalCredito*100)/100}cambiarMultiplesFormasPago(){this.formaPago="Efectivo",this.multiplesFormasPago=!this.multiplesFormasPago,this.multiplesFormasPago?this.formasPagoArray=ge:this.formasPagoArray=J,this.valorFormaPago=this.precioTotalLimpio,this.precioTotalVenta=this.precioTotalLimpio,this.faltaPagar=this.precioTotalVenta,this.totalPagado=0,this.formasPago=[]}agregarFormaPago(){if(this.valorFormaPago<=0){this.alertService.info("Debe colocar un monto valido");return}if(this.formasPago.find(a=>a.descripcion==this.formaPago))return this.alertService.info("La forma de pago ya esta agregada");if(this.totalPagado+=this.valorFormaPago,this.totalPagado>this.precioTotalVenta){this.alertService.info("El total pagado no puede ser mayor al precio final"),this.totalPagado-=this.valorFormaPago;return}this.formasPago.unshift({valor:this.valorFormaPago,descripcion:this.formaPago,creatorUserId:this.authService.usuario.userId}),this.calcularPrecioFinal(),this.calcularFaltaPagar()}calcularFaltaPagar(){this.faltaPagar=this.precioTotalVenta-this.totalPagado,this.faltaPagar=Math.round(this.faltaPagar*100)/100,this.valorFormaPago=this.faltaPagar}eliminarFormaPago(n){this.formasPago=this.formasPago.filter(a=>a.descripcion!=n),this.totalPagado=0,this.formasPago.forEach(a=>{this.totalPagado+=a.valor}),this.calcularFaltaPagar()}completarVenta(){if((this.formaPago==="PedidosYa - Efectivo"||this.formaPago==="PedidosYa - Online")&&!this.multiplesFormasPago&&this.pedidosYaComprobante===""){this.alertService.info("Debe colocar el nro de comprobante");return}if(this.multiplesFormasPago&&this.precioTotalVenta-this.totalPagado>.1){this.alertService.info("El total pagado debe ser igual al precio final");return}let n=(this.formaPago==="PedidosYa - Efectivo"||this.formaPago==="PedidosYa - Online")&&!this.multiplesFormasPago,a={comprobante:this.comprobante,precioTotal:this.precioTotalVenta,totalAdelantoReserva:this.precioTotalVenta,totalCompletarReserva:0,totalBalanza:0,totalNoBalanza:0,precioTotalLimpio:this.precioTotalLimpio,adicionalCredito:!this.multiplesFormasPago&&this.formaPago==="Credito"?this.adicionalCredito:0,creatorUserId:this.authService.usuario.userId},i=[];this.carritoProductos.map(P=>{i.push({productoId:P.producto.id,cantidad:P.cantidad,precioUnitario:P.precioUnitario,precioTotal:P.precioTotal,creatorUserId:this.authService.usuario.userId})});let u=[];this.multiplesFormasPago?u=this.formasPago:u=[{valor:this.precioTotalVenta,descripcion:this.formaPago,nroComprobante:n?this.pedidosYaComprobante:"",creatorUserId:this.authService.usuario.userId}];let U={dataVenta:a,dataFacturacion:{puntoVenta:0,tipoComprobante:0,nroComprobante:0},dataFormasPago:u,dataProductos:[],dataOtros:{imprimirTicket:this.imprimirTicket}};this.alertService.question({msg:"\xBFQuieres completar la reserva?",buttonText:"Completar"}).then(({isConfirmed:P})=>{if(P){this.alertService.loading();let z=this.dataReserva.fechaEntrega+":"+this.dataReserva.horaEntrega,q=Q(me(new Date(z),{hours:-Number(this.dataReserva.horasAntes)}),"yyyy-MM-dd:HH:mm"),K=[];this.carritoProductos.map(M=>{K.push({productoId:M.producto.id,cantidad:M.cantidad,precioUnitario:M.producto.precioVenta,precioTotal:M.precioTotal})});let Se={productos:K,clienteId:this.clienteSeleccionado.id,usuarioCreador:this.dataReserva.usuarioCreador,fechaReserva:this.dataReserva.fechaReserva,fechaEntrega:this.dataReserva.fechaEntrega,horaEntrega:this.dataReserva.horaEntrega,adelanto:this.dataReserva.adelanto,precioTotal:this.dataReserva.precioTotal,observaciones:this.dataReserva.observaciones,horasAntes:this.dataReserva.horasAntes,tipoObservacion:this.dataReserva.tipoObservacion,fechaAlerta:q,tortaRelleno1:this.dataReserva.tipoObservacion==="Torta"?this.dataReserva.tortaRelleno1:"",tortaRelleno2:this.dataReserva.tipoObservacion==="Torta"?this.dataReserva.tortaRelleno2:"",tortaRelleno3:this.dataReserva.tipoObservacion==="Torta"?this.dataReserva.tortaRelleno3:"",tortaForma:this.dataReserva.tipoObservacion==="Torta"?this.dataReserva.tortaForma:"",tortaPeso:this.dataReserva.tipoObservacion==="Torta"?this.dataReserva.tortaPeso:0,tortaCobertura:this.dataReserva.tipoObservacion==="Torta"?this.dataReserva.tortaCobertura:"",tortaDetalles:this.dataReserva.tipoObservacion==="Torta"?this.dataReserva.tortaDetalles:"",creatorUserId:this.authService.usuario.userId};this.reservasService.nuevaReserva(Se).subscribe({next:({reserva:M})=>{this.ventasService.nuevaVenta(U).subscribe({next:({venta:Z})=>{let we={ventaId:Z.id,reservaId:M.id,tipo:"Adelanto",creatorUserId:this.authService.usuario.userId};this.ventasReservasService.nuevaVentaReserva(we).subscribe({next:()=>{this.router.navigateByUrl("/dashboard/reservas"),this.dataService.alertaReservas(),window.open(`${et}/reservas/generar/comprobante/${M.id}`,"_blank"),this.alertService.close()},error:({error:ye})=>this.alertService.errorApi(ye.message)})},error:({error:Z})=>this.alertService.errorApi(Z.message)})},error:({error:M})=>this.alertService.errorApi(M.message)})}})}};m.\u0275fac=function(a){return new(a||m)(w(L),w(H),w(ce),w(fe),w(re),w(_e),w(de),w(Ce),w(te))},m.\u0275cmp=k({type:m,selectors:[["app-reservas-nueva"]],standalone:!0,features:[F],decls:163,vars:47,consts:[[3,"insertEvent"],[3,"showModal"],[1,"flex","items-center","justify-between","bg-gray-800","rounded-t","p-2"],[1,"flex","items-center"],["title","Regresar a datos de reserva",1,"text-white","hover:text-secondaryColor",3,"click"],["xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 24 24","stroke-width","1.5","stroke","currentColor",1,"w-5","h-5"],["stroke-linecap","round","stroke-linejoin","round","d","M10.5 19.5 3 12m0 0 7.5-7.5M3 12h18"],[1,"text-white","px-2","py-1","rounded-t","text-lg"],["width","20","height","20","viewBox","0 0 24 24","fill","none","stroke","currentColor","stroke-width","2","stroke-linecap","round","stroke-linejoin","round",1,"cursor-pointer","feather","feather-x","text-white","mr-2",3,"click"],["x1","18","y1","6","x2","6","y2","18"],["x1","6","y1","6","x2","18","y2","18"],[1,"text-sm"],[1,"text-xs","md:text-sm","flex","bg-gray-100","items-center","border-b","border-gray-400","justify-between","px-3","py-3"],[1,"border","p-2","border-gray-400","bg-white"],[1,"font-semibold"],[1,"bg-purple-100","p-2","border","border-secondaryColor"],[1,"max-h-96","overflow-y-auto"],[1,"p-2"],[1,"input-generico","w-1/2","mt-2",3,"ngModel","ngModelChange"],["value","Normal"],["value","Facturacion"],["title","Proximo numero de factura","class","p-2 border hover:text-secondaryColor border-gray-400 rounded mt-2 ml-2",4,"ngIf"],["class","px-2 py-1 shadow bg-gray-50 mt-2 flex items-center border border-gray-400 rounded",3,"click",4,"ngIf"],[1,"px-2","mt-1","text-sm"],["placeholder","Paga con...","type","text",1,"input-generico","w-1/2",3,"ngModel","keyup","ngModelChange"],[1,"w-1/2","bg-gray-100","border","border-gray-400","p-2","m-2","text-center"],[1,"flex","items-center","justify-between"],[1,"font-semibold","w-1/2"],[1,"md:flex","md:items-center","mt-2"],[1,"input-generico","w-full","md:w-1/2",3,"ngModel","change","ngModelChange"],[3,"value",4,"ngFor","ngForOf"],["class","md:ml-2 mt-2 md:mt-0 w-full md:w-1/2",4,"ngIf"],["class","md:w-1/2 w-full p-2 border border-gray-400 rounded md:ml-2 mt-2 md:mt-0 hover:text-secondaryColor",3,"click",4,"ngIf"],["class","flex items-center",4,"ngIf"],["class","mt-3",4,"ngIf"],[1,"p-2","mt-2"],[1,"boton-crear","w-full",3,"click"],[1,"bg-white","text-sm"],[1,"bg-gray-100","border-b","border-gray-400","p-2","flex","items-center","justify-between"],[1,"text-center","mt-1"],[1,"mt-2","flex","items-center"],["type","date",1,"input-generico","w-1/2",3,"ngModel","ngModelChange"],["type","time",1,"input-generico","w-1/2","ml-2",3,"ngModel","ngModelChange"],[1,"text-center","mt-3"],[1,"input-generico","w-full","mt-2",3,"ngModel","ngModelChange"],["value","1"],["value","2"],["value","3"],["value","4"],["value","5"],["type","text","placeholder","Ej. Moreno Lucas Omar",1,"input-generico","w-full","mt-2",3,"ngModel","ngModelChange"],[1,"border-t","flex","items-center","border-gray-400","pt-2","mt-4"],[1,"w-1/2"],[1,"text-center","font-semibold"],["type","number","placeholder","Ej. 3000",1,"input-generico","text-center","w-full",3,"ngModel","keyup","ngModelChange"],[1,"w-1/2","ml-2"],[1,"font-semibold","text-center"],[1,"p-2","text-center","bg-gray-200","rounded","w-full","border","border-gray-400"],[1,"p-2","bg-secondaryColor","text-white","rounded","w-full","mt-4","hover:opacity-90",3,"click"],[1,"gsap-contenido"],[1,"border","border-gray-400","mt-2","w-11/12","md:w-1/2","mb-4","mx-auto"],[1,"bg-gray-900","text-white","flex","items-center","justify-between","border","border-gray-900","p-3","text-xl"],[1,"ml-4"],["title","Completar reserva","class","p-2 text-gray-900 hover:text-secondaryColor bg-white rounded",3,"click",4,"ngIf"],[1,"p-4","text-sm"],[1,"w-full","md:flex","md:items-center","md:justify-between"],[1,"md:w-max","text-center","md:ml-2"],["type","date",1,"border","focus:outline-none","w-full","border-gray-400","p-2","mt-2",3,"ngModel","ngModelChange"],[1,"text-center","mt-2","md:mt-0","md:mr-2"],[1,"md:w-40","w-full","p-2","bg-gray-200","mt-2","font-semibold","text-center","border","border-gray-400"],[1,"md:p-2","mt-4","md:mt-2"],[1,"bg-gray-100","font-semibold","p-2","border","border-gray-400"],[4,"ngIf"],[1,"md:p-2","mt-4","md:mt-0"],[1,"bg-gray-100","font-semibold","p-2","border","border-gray-400","flex","items-center","justify-between"],["title","Agregar producto",1,"bg-white","focus:outline-none","rounded","border","border-gray-400","p-2","hover:text-secondaryColor",3,"click"],["stroke-linecap","round","stroke-linejoin","round","d","M12 4.5v15m7.5-7.5h-15"],[1,"max-h-52","overflow-y-auto"],[1,"bg-gray-100","flex","items-center","justify-between","p-2","border","border-gray-400"],[1,"input-generico",3,"ngModel","ngModelChange"],["value","General"],["value","Torta"],["title","Proximo numero de factura",1,"p-2","border","hover:text-secondaryColor","border-gray-400","rounded","mt-2","ml-2"],["stroke-linecap","round","stroke-linejoin","round","d","M19.5 14.25v-2.625a3.375 3.375 0 0 0-3.375-3.375h-1.5A1.125 1.125 0 0 1 13.5 7.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H8.25m5.231 13.481L15 17.25m-4.5-15H5.625c-.621 0-1.125.504-1.125 1.125v16.5c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 0 0-9-9Zm3.75 11.625a2.625 2.625 0 1 1-5.25 0 2.625 2.625 0 0 1 5.25 0Z"],[1,"px-2","py-1","shadow","bg-gray-50","mt-2","flex","items-center","border","border-gray-400","rounded",3,"click"],["xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 24 24","stroke-width","1.5","stroke","currentColor",1,"w-4","h-4","text-red-700","font-semibold"],["stroke-linecap","round","stroke-linejoin","round","d","M6 18 18 6M6 6l12 12"],[1,"text-xs"],[3,"value"],[1,"md:ml-2","mt-2","md:mt-0","w-full","md:w-1/2"],["placeholder","Nro comprobante pedidosYa","type","text",1,"input-generico","w-full",3,"ngModel","ngModelChange"],[1,"md:w-1/2","w-full","p-2","border","border-gray-400","rounded","md:ml-2","mt-2","md:mt-0","hover:text-secondaryColor",3,"click"],["placeholder","Ej. 1000","type","number","min","0",1,"input-generico","w-full","mt-2","md:mt-0","md:ml-2",3,"ngModel","keyup.enter","ngModelChange"],["title","Agregar forma de pago",1,"boton-crear","ml-2","mt-2","md:mt-0",3,"click"],["title","Regresar a forma unica",1,"boton-eliminar","ml-2","mt-2","md:mt-0",3,"click"],[1,"mt-3"],[1,"bg-gray-100","border","border-gray-400","p-2"],[1,"flex","items-center","p-2","justify-between","border-b","border-gray-400"],[1,"w-1/3"],["title","Quitar forma de pago",1,"boton-eliminar",3,"click"],["stroke-linecap","round","stroke-linejoin","round","d","m14.74 9-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 0 1-2.244 2.077H8.084a2.25 2.25 0 0 1-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 0 0-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 0 1 3.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 0 0-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 0 0-7.5 0"],[1,"p-2","bg-gray-50","italic","text-xs","border","border-t-0","border-gray-400","text-center","text-gray-600"],["class","flex items-center p-2 justify-between border-b border-gray-400"],["title","Completar reserva",1,"p-2","text-gray-900","hover:text-secondaryColor","bg-white","rounded",3,"click"],["stroke-linecap","round","stroke-linejoin","round","d","m4.5 12.75 6 6 9-13.5"],["type","text","placeholder","DNI, CUIL o CUIT",1,"border","focus:outline-none","border-gray-400","p-2","mt-4","w-full","md:w-52",3,"ngModel","keyup.enter","ngModelChange"],["title","Buscar cliente",1,"bg-gray-50","border","border-gray-400","rounded","p-2","hover:text-secondaryColor","mt-4","ml-2",3,"click"],["stroke-linecap","round","stroke-linejoin","round","d","m21 21-5.197-5.197m0 0A7.5 7.5 0 1 0 5.196 5.196a7.5 7.5 0 0 0 10.607 10.607Z"],[1,"flex","mt-4","w-max","items-center"],["src","assets/svg/cliente.svg",1,"w-14"],[1,"text-xs","text-gray-500"],["class","text-xs text-gray-500",4,"ngIf"],[1,"text-red-500","text-xs","ml-2","border","rounded","border-red-300","bg-red-50","p-1","mt-4",3,"click"],[1,"p-2","border","my-2","flex","items-center","justify-between","border-gray-400"],["src","assets/svg/producto.svg","alt","Producto.svg",1,"w-16"],[1,"ml-3"],[1,"font-semibold","text-xs","md:text-sm"],[1,"text-gray-500","text-xs","mt-1"],[1,"font-semibold","mt-1","text-xs","md:text-sm"],[1,"mr-2"],["title","Eliminar producto",1,"p-2","bg-red-700","hover:opacity-90","text-white","rounded",3,"click"],["xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 24 24","stroke-width","1.5","stroke","currentColor",1,"w-4","h-4","md:w-5","md:h-5"],[1,"text-gray-500","mt-2"],[1,"p-2","rounded","bg-secondaryColor","hover:opacity-90","text-white","mt-2",3,"click"],["placeholder","Puede colocar una observacion aqu\xED (No saldra en el comprobante)",1,"w-full","border","border-gray-400","focus:outline-none","p-2","mt-4",3,"ngModel","ngModelChange"],[1,"md:p-2","mt-2"],[1,"md:flex","md:items-center"],[1,"md:w-1/2"],[1,"text-red-500"],["type","text","placeholder","Ej. Chocolate",1,"input-generico","w-full","mt-2",3,"ngModel","ngModelChange"],[1,"md:ml-2","md:w-1/2","mt-2","md:mt-0"],["type","text","placeholder","Ej. Vainilla",1,"input-generico","w-full","mt-2",3,"ngModel","ngModelChange"],[1,"md:p-2","mt-2","md:mt-1"],["type","text","placeholder","Ej. Frutilla",1,"input-generico","w-full","mt-2",3,"ngModel","ngModelChange"],["type","text","placeholder","Ej. Redonda",1,"input-generico","w-full","mt-2",3,"ngModel","ngModelChange"],[1,"md:p-2","md:mt-1","mt-2"],["type","number","placeholder","Ej. 1.5",1,"input-generico","w-full","mt-2",3,"ngModel","ngModelChange"],[1,"md:ml-2","md:w-1/2","mt-2"],[1,"md:p-2","mt-2","md:mt-0"],["placeholder","Otros detalles de la torta",1,"input-generico","w-full","mt-2",3,"ngModel","ngModelChange"],[1,"md:px-2"],["placeholder","Puede colocar una observaci\xF3n aqu\xED (No saldra en el comprobante)",1,"input-generico","w-full","mt-2",3,"ngModel","ngModelChange"],["class","p-2 border my-2 flex items-center justify-between border-gray-400"]],template:function(a,i){a&1&&(e(0,"app-agregar-producto",0),d("insertEvent",function(h){return i.agregarProducto(h)}),t(),e(1,"app-abm-cliente",0),d("insertEvent",function(h){return i.seleccionarCliente(h)}),t(),e(2,"app-modal",1)(3,"div",2)(4,"div",3)(5,"button",4),d("click",function(){return i.regresarReserva()}),f(),e(6,"svg",5),x(7,"path",6),t()(),R(),e(8,"h1",7),o(9," Completando venta "),t()(),f(),e(10,"svg",8),d("click",function(){return i.showModalCompletar=!1}),x(11,"line",9)(12,"line",10),t()(),R(),e(13,"div",11)(14,"div",12)(15,"p",13)(16,"span",14),o(17," Fecha: "),t(),o(18),b(19,"fecha"),t(),e(20,"p",15)(21,"span",14),o(22," Precio total: "),t(),o(23),b(24,"moneda"),t()(),e(25,"div",16)(26,"div",17)(27,"p",14),o(28," Tipo de venta "),t(),e(29,"div",3)(30,"select",18),d("ngModelChange",function(h){return i.comprobante=h}),e(31,"option",19),o(32," Normal "),t(),e(33,"option",20),o(34," Guia de despacho "),t()(),y(35,je,3,0,"button",21),t(),y(36,De,5,0,"button",22),t(),e(37,"div",23)(38,"p",14),o(39," Calculador de vuelto "),t(),e(40,"div",3)(41,"input",24),d("keyup",function(){return i.calcularVuelto()})("ngModelChange",function(h){return i.pagaCon=h}),t(),e(42,"div",25),o(43),b(44,"moneda"),t()()(),e(45,"div",23)(46,"div",26)(47,"p",27),o(48),t()(),e(49,"div",28)(50,"select",29),d("change",function(){return i.cambiarFormaPago()})("ngModelChange",function(h){return i.formaPago=h}),y(51,Oe,2,2,"option",30),t(),y(52,Be,2,1,"div",31)(53,Ge,2,0,"button",32)(54,Le,8,1,"div",33),t(),y(55,Ue,7,1,"div",34),t()(),e(56,"div",35)(57,"button",36),d("click",function(){return i.completarVenta()}),o(58," Completar reserva "),t()()()(),e(59,"app-modal",1)(60,"div")(61,"div",2)(62,"h1",7),o(63," Generando reserva "),t(),f(),e(64,"svg",8),d("click",function(){return i.showModalGenerarReserva=!1}),x(65,"line",9)(66,"line",10),t()(),R(),e(67,"div",37)(68,"div",38)(69,"p")(70,"span",14),o(71," Fecha de reserva: "),t(),o(72),b(73,"fecha"),t(),e(74,"p")(75,"span",14),o(76," Precio total: "),t(),o(77),b(78,"moneda"),t()(),e(79,"div",17)(80,"div",39)(81,"p",14),o(82," Fecha y hora de entrega "),t(),e(83,"div",40)(84,"input",41),d("ngModelChange",function(h){return i.dataReserva.fechaEntrega=h}),t(),e(85,"input",42),d("ngModelChange",function(h){return i.dataReserva.horaEntrega=h}),t()()(),e(86,"div",43)(87,"p",14),o(88," La alerta se activar\xE1 "),t(),e(89,"select",44),d("ngModelChange",function(h){return i.dataReserva.horasAntes=h}),e(90,"option",45),o(91," 1 hora antes "),t(),e(92,"option",46),o(93," 2 hora antes "),t(),e(94,"option",47),o(95," 3 hora antes "),t(),e(96,"option",48),o(97," 4 hora antes "),t(),e(98,"option",49),o(99," 5 hora antes "),t()()(),e(100,"div",43)(101,"p",14),o(102," Coloca tu nombre "),t(),e(103,"input",50),d("ngModelChange",function(h){return i.dataReserva.usuarioCreador=h}),t()(),e(104,"div",51)(105,"div",52)(106,"p",53),o(107," Monto de se\xF1a "),t(),e(108,"input",54),d("keyup",function(){return i.calcularFaltaPagarReserva()})("ngModelChange",function(h){return i.dataReserva.adelanto=h}),t()(),e(109,"div",55)(110,"p",56),o(111," Falta pagar "),t(),e(112,"div",57),o(113),b(114,"moneda"),t()()(),e(115,"button",58),d("click",function(){return i.abrirCompletarVenta()}),o(116," Generar reserva "),t()()()()(),e(117,"div",59)(118,"div",60)(119,"div",61)(120,"div",3)(121,"h1",62),o(122," Nueva Reserva "),t()(),y(123,ze,3,0,"button",63),t(),e(124,"div",64)(125,"div",65)(126,"div",66)(127,"p",14),o(128," Fecha de reserva "),t(),e(129,"input",67),d("ngModelChange",function(h){return i.dataReserva.fechaReserva=h}),t()(),e(130,"div",68)(131,"p",14),o(132," Precio total "),t(),e(133,"div",69),o(134),b(135,"moneda"),t()()(),e(136,"div",70)(137,"div",71),o(138," Datos de cliente "),t(),y(139,qe,5,1,"div",33)(140,Qe,11,4,"div",72),t(),e(141,"div",73)(142,"div",74)(143,"h2"),o(144," Datos de producto "),t(),e(145,"button",75),d("click",function(){return i.abrirModalAgregarProducto()}),f(),e(146,"svg",5),x(147,"path",76),t()()(),R(),e(148,"div",77),T(149,Je,18,9,"div",142,Ae,!1,Ke,5,0),t()(),e(152,"div",73)(153,"div",78)(154,"h2",14),o(155," Observaciones "),t(),e(156,"select",79),d("ngModelChange",function(h){return i.dataReserva.tipoObservacion=h}),e(157,"option",80),o(158," General "),t(),e(159,"option",81),o(160," Torta "),t()()(),y(161,We,2,1,"div",72)(162,Xe,47,8,"div",72),t()()()()),a&2&&(l(2),c("showModal",i.showModalCompletar),l(16),_(" ",S(19,33,i.fechaActual)," "),l(5),_(" $",S(24,35,i.precioTotalVenta)," "),l(7),c("ngModel",i.comprobante),l(5),c("ngIf",i.comprobante==="Facturacion"),l(),c("ngIf",!i.imprimirTicket),l(5),c("ngModel",i.pagaCon),l(2),_(" ",i.vuelto?"$"+S(44,37,i.vuelto):"Monto a devolver"," "),l(5),_(" ",i.multiplesFormasPago?"Multiples formas de pago":"Forma de pago"," "),l(2),c("ngModel",i.formaPago),l(),c("ngForOf",i.formasPagoArray),l(),c("ngIf",i.formaPago==="PedidosYa - Efectivo"||i.formaPago==="PedidosYa - Online"),l(),c("ngIf",!i.multiplesFormasPago&&i.formaPago!=="PedidosYa - Efectivo"&&i.formaPago!=="PedidosYa - Online"),l(),c("ngIf",i.multiplesFormasPago),l(),c("ngIf",i.multiplesFormasPago),l(4),c("showModal",i.showModalGenerarReserva),l(13),_(" ",S(73,39,i.dataReserva.fechaReserva)," "),l(5),_(" $",S(78,41,i.dataReserva.precioTotal)," "),l(7),c("ngModel",i.dataReserva.fechaEntrega),l(),c("ngModel",i.dataReserva.horaEntrega),l(4),c("ngModel",i.dataReserva.horasAntes),l(14),c("ngModel",i.dataReserva.usuarioCreador),l(5),c("ngModel",i.dataReserva.adelanto),l(5),_(" $ ",S(114,43,i.faltaPagar)," "),l(10),c("ngIf",i.carritoProductos.length>0&&i.clienteSeleccionado),l(6),c("ngModel",i.dataReserva.fechaReserva),l(5),_(" $",S(135,45,i.dataReserva.precioTotal)," "),l(5),c("ngIf",!i.clienteSeleccionado),l(),c("ngIf",i.clienteSeleccionado),l(9),V(i.carritoProductos),l(7),c("ngModel",i.dataReserva.tipoObservacion),l(5),c("ngIf",i.dataReserva.tipoObservacion==="General"),l(),c("ngIf",i.dataReserva.tipoObservacion==="Torta"))},dependencies:[I,ee,N,G,oe,ne,j,B,ae,D,le,O,pe,$,ue,A,Y,xe,be],encapsulation:2});let s=m;return s})();export{Dt as default};
